#!/bin/bash
# scripts/cron
# Execute scheduled tasks

# Colors for output
GREEN='\033[0;32m'
YELLOW='\033[1;33m'
NC='\033[0m'

# Load environment variables
if [ -f .env ]; then
    export $(cat .env | grep -v '^#' | xargs)
fi

CONTAINER_NAME="${COMPOSE_PROJECT_NAME:-laravel-app}_php"

# Check if container is running
if ! docker ps --format "table {{.Names}}" | grep -q "^${CONTAINER_NAME}$"; then
    echo -e "${YELLOW}Warning: scheduler container '${CONTAINER_NAME}' is not running${NC}"
    echo "Starting containers..."
    docker compose up -d scheduler
    sleep 3
fi

# If no arguments provided, start interactive shell
if [ $# -eq 0 ]; then
    echo -e "${GREEN}Show cron tasks (use crontab -e if you want to edit)...${NC}"
    docker compose exec scheduler crontab -l
else
    echo -e "${GREEN}Executing: php $@${NC}"
    docker compose exec scheduler crontab "$@"
fi

docker compose exec scheduler crontab -e