#!/bin/bash
# scripts/logs
# View Docker container logs

# Colors for output
GREEN='\033[0;32m'
YELLOW='\033[1;33m'
RED='\033[0;31m'
NC='\033[0m'

# Load environment variables
if [ -f .env ]; then
    export $(cat .env | grep -v '^#' | xargs)
fi

PROJECT_NAME="${COMPOSE_PROJECT_NAME:-laravel-app}"

show_usage() {
    echo -e "${GREEN}Docker Logs Viewer${NC}"
    echo -e "${YELLOW}Usage: ./scripts/logs [service] [options]${NC}"
    echo ""
    echo "Services:"
    echo "  nginx      - Web server logs"
    echo "  php        - PHP-FPM logs"
    echo "  mysql      - Database logs"
    echo "  redis      - Cache logs"
    echo "  node       - Node.js logs"
    echo "  queue      - Queue worker logs"
    echo "  scheduler  - Task scheduler logs"
    echo "  all        - All services logs"
    echo ""
    echo "Options:"
    echo "  -f, --follow    - Follow log output (default)"
    echo "  -t, --tail N    - Show last N lines (default: 100)"
    echo "  --no-follow     - Don't follow log output"
    echo ""
    echo "Examples:"
    echo "  ./scripts/logs php"
    echo "  ./scripts/logs nginx --tail 50"
    echo "  ./scripts/logs all --no-follow"
}

# Default options
FOLLOW="-f"
TAIL="--tail=100"

# Parse arguments
SERVICE=""
while [[ $# -gt 0 ]]; do
    case $1 in
        -f|--follow)
            FOLLOW="-f"
            shift
            ;;
        --no-follow)
            FOLLOW=""
            shift
            ;;
        -t|--tail)
            TAIL="--tail=$2"
            shift 2
            ;;
        nginx|php|mysql|redis|node|queue|scheduler|all)
            SERVICE="$1"
            shift
            ;;
        -h|--help)
            show_usage
            exit 0
            ;;
        *)
            echo -e "${RED}Unknown option: $1${NC}"
            show_usage
            exit 1
            ;;
    esac
done

# If no service specified, show usage
if [ -z "$SERVICE" ]; then
    show_usage
    exit 0
fi

# Show logs
case "$SERVICE" in
    "all")
        echo -e "${GREEN}Showing logs for all services...${NC}"
        docker compose logs $FOLLOW $TAIL
        ;;
    *)
        echo -e "${GREEN}Showing logs for $SERVICE service...${NC}"
        docker compose logs $FOLLOW $TAIL $SERVICE
        ;;
esac